<!doctype html>
<html lang="en" class="no-js">
    <head>
        <!-- Title and Icon -->

        <title>MiroTalk P2P - Host Protected login required.</title>
        <link rel="shortcut icon" href="../images/logo.svg" />
        <link rel="apple-touch-icon" href="../images/logo.svg" />

        <!-- Meta Information -->

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <meta
            name="description"
            content="MiroTalk powered by WebRTC, Real-time Simple Secure Fast video calls, chat and screen sharing capabilities in the browser, from your mobile or desktop."
        />
        <meta
            name="keywords"
            content="webrtc, self hosted, voip, sip, real-time communications, chat, messaging, meet, webrtc stun, webrtc turn, video meeting, video chat, video conference, multi video chat, multi video conference, peer to peer, p2p, rtc, alternative to, zoom, microsoft teams, google meet, jitsi, meeting"
        />

        <!-- https://ogp.me -->

        <meta property="og:type" content="app-webrtc" />
        <meta property="og:site_name" content="MiroTalk" />
        <meta property="og:title" content="Click the link to make a call." />
        <meta
            property="og:description"
            content="MiroTalk calling provides real-time HD quality and latency simply not available with traditional technology."
        />
        <meta property="og:image" content="https://p2p.mirotalk.com/images/preview.png" />
        <meta property="og:url" content="https://p2p.mirotalk.com" />

        <!-- StyleSheet -->

        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,600" />
        <link rel="stylesheet" href="../css/landing.css" />

        <!-- Js scripts -->

        <script src="https://unpkg.com/animejs@3.0.1/lib/anime.min.js"></script>
        <script src="https://unpkg.com/scrollreveal@4.0.0/dist/scrollreveal.min.js"></script>

        <!-- xss -->

        <script src="https://rawgit.com/leizongmin/js-xss/master/dist/xss.js"></script>

        <!-- axios -->

        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    </head>
    <body class="has-animations">
        <div class="body-wrap">
            <header class="site-header reveal-from-top">
                <div class="container">
                    <div class="site-header-inner">
                        <div class="brand">
                            <div class="m-0">
                                <a href="/"><img src="../images/logo.svg" alt="Neon" width="32" height="32" /></a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <main class="site-content">
                <section class="hero section illustration-section-01">
                    <div class="container">
                        <div class="hero-inner section-inner">
                            <div class="split-wrap invert-mobile">
                                <div class="split-item">
                                    <div class="hero-content split-item-content center-content-mobile">
                                        <div id="loginForm">
                                            <br />
                                            <div class="mb-12">
                                                <input
                                                    id="username"
                                                    class="form-input"
                                                    type="name"
                                                    placeholder="Username"
                                                    maxlength="32"
                                                    style="border-radius: 6px"
                                                    required
                                                />
                                            </div>
                                            <br />
                                            <div class="mb-12">
                                                <input
                                                    id="password"
                                                    class="form-input"
                                                    type="password"
                                                    maxlength="32"
                                                    style="border-radius: 6px"
                                                    placeholder="Password"
                                                    required
                                                />
                                            </div>
                                            <div class="mt-24 mb-32">
                                                <button
                                                    id="loginButton"
                                                    class="button button-primary button-block pulse"
                                                >
                                                    Login
                                                </button>
                                            </div>
                                        </div>
                                        <script>
                                            console.log(window.location);

                                            const usernameInput = document.getElementById('username');
                                            const passwordInput = document.getElementById('password');
                                            const loginBtn = document.getElementById('loginButton');

                                            usernameInput.onkeyup = (e) => {
                                                if (e.keyCode === 13) {
                                                    e.preventDefault();
                                                    login();
                                                }
                                            };
                                            passwordInput.onkeyup = (e) => {
                                                if (e.keyCode === 13) {
                                                    e.preventDefault();
                                                    login();
                                                }
                                            };

                                            loginBtn.onclick = (e) => {
                                                login();
                                            };

                                            function login() {
                                                let username = filterXSS(document.getElementById('username').value);
                                                let password = filterXSS(document.getElementById('password').value);

                                                // http://localhost:3000/join/?room=test
                                                // http://localhost:3000/join/?room=test&name=mirotalk&audio=0&video=0&screen=0&notify=0
                                                const qs = new URLSearchParams(window.location.search);
                                                const room = filterXSS(qs.get('room'));

                                                // http://localhost:3000/join/test
                                                const pathParts = window.location.pathname.split('/');
                                                const roomPath = pathParts[pathParts.length - 1];

                                                if (username && password) {
                                                    axios
                                                        .post('/login', {
                                                            username: username,
                                                            password: password,
                                                        })
                                                        .then(function (response) {
                                                            console.log(response);

                                                            if (room) {
                                                                return (window.location.href =
                                                                    '/join/' + window.location.search);
                                                            }

                                                            if (roomPath) {
                                                                return (window.location.href = '/join/' + roomPath);
                                                            }

                                                            return (window.location.href = '/logged');
                                                        })
                                                        .catch(function (error) {
                                                            console.error(error);
                                                            alert('Unauthorized');
                                                        });
                                                    return;
                                                }
                                                if (!username && !password) {
                                                    alert('Username and Password required');
                                                    return;
                                                }
                                                if (!username) {
                                                    alert('Username required');
                                                    return;
                                                }
                                                if (!password) {
                                                    alert('Password required');
                                                    return;
                                                }
                                            }
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

                <footer class="site-footer center-content-mobile">
                    <div class="container">
                        <div class="site-footer-inner">
                            <div class="footer-top space-between text-xxs">
                                <div class="brand">
                                    <a href="/"><img src="../images/logo.svg" alt="Neon" width="32" height="32" /></a>
                                </div>
                                <div class="footer-social">
                                    <ul class="list-reset">
                                        <li>
                                            <a target="_blank" href="https://github.com/mmguero/mirotalk">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                >
                                                    <title>GitHub</title>
                                                    <path
                                                        d="M7.95 0C3.578 0 0 3.578 0 7.95c0 3.479 2.286 6.46 5.466 7.553.397.1.497-.199.497-.397v-1.392c-2.187.497-2.683-.994-2.683-.994-.398-.894-.895-1.192-.895-1.192-.696-.497.1-.497.1-.497.795.1 1.192.795 1.192.795.696 1.292 1.888.894 2.286.696.1-.497.298-.895.497-1.093-1.79-.2-3.578-.895-3.578-3.976 0-.894.298-1.59.795-2.087-.1-.198-.397-.993.1-2.086 0 0 .695-.2 2.186.795a6.408 6.408 0 0 1 1.987-.299c.696 0 1.392.1 1.988.299 1.49-.994 2.186-.795 2.186-.795.398 1.093.199 1.888.1 2.086.496.597.795 1.292.795 2.087 0 3.081-1.889 3.677-3.677 3.876.298.398.596.895.596 1.59v2.187c0 .198.1.496.596.397C13.714 14.41 16 11.43 16 7.95 15.9 3.578 12.323 0 7.95 0z"
                                                    />
                                                </svg>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="footer-bottom space-between text-xxs invert-order-desktop">
                                <nav class="footer-nav">
                                    <ul class="list-reset">
                                        <li>
                                            <a href="/about">About</a>
                                        </li>
                                        <li>
                                            <a href="/privacy">Privacy Policy</a>
                                        </li>
                                    </ul>
                                </nav>
                                <div class="footer-copyright">&copy; 2023 MiroTalk, all rights reserved</div>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>

        <script defer src="../js/landing.js"></script>
        <script async defer src="https://buttons.github.io/buttons.js"></script>
    </body>
</html>
